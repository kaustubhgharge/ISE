<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smart Waste Management Dashboard</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body class="p-4">
  <h1>Smart Waste Management Dashboard</h1>

  <h3>Waste Bins Status</h3>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Bin ID</th>
        <th>Fill Level (%)</th>
        <th>Last Emptied (days)</th>
      </tr>
    </thead>
    <tbody id="bins-table-body">
      {% for bin in bins.values() %}
      <tr>
        <td>{{ bin.bin_id }}</td>
        <td>{{ bin.fill_level }}</td>
        <td>{{ bin.last_emptied_days }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <button id="generate-route-btn" class="btn btn-primary mb-3">
    Generate Optimized Route
  </button>

  <h3>Optimized Route:</h3>
  <ol id="route-list"></ol>

  <h3>Alerts:</h3>
  <div id="alerts"></div>

  <script>
    const socket = io();

    socket.on('alert', (data) => {
      const alertsDiv = document.getElementById('alerts');
      const alertItem = document.createElement('div');
      alertItem.className = 'alert alert-warning';
      alertItem.innerText = data.message;
      alertsDiv.prepend(alertItem);
    });

    document
      .getElementById('generate-route-btn')
      .addEventListener('click', () => {
        fetch('/generate-route')
          .then((res) => res.json())
          .then((data) => {
            const routeList = document.getElementById('route-list');
            routeList.innerHTML = '';
            if (data.route.length === 0) {
              routeList.innerHTML = '<li>No bins need collection</li>';
            } else {
              data.route.forEach((binId) => {
                const li = document.createElement('li');
                li.innerText = binId;
                routeList.appendChild(li);
              });
            }
          });
      });
  </script>
</body>
</html>
